{% extends '../layouts/master.html' %}
{% load static %}
{% load curso_anterior %}

{% block 'titulo' %}
Cursos del Establecimiento Manheim
{% endblock 'titulo' %}

{% block 'css-select2' %}
<link rel="stylesheet"  href="{% static 'css/multi-select.css' %}">
{% endblock 'css-select2' %}

{% block 'content' %}
{% get_anterior_curso curso.numero as curso_ant%}

<div class="row mx-0 h-100 w-100">
    <div class="col-12 h-100">
        <div class="row mx-0 h-100">
            <div class="col-4 h-100 p-3">
                <div class="card shadow" style="height: 30%;">
                    <div class="text-center">
                        <div class="card-header">
                          {{curso.cod_fecha.year}} - {{curso.cod_fecha.get_semestres_display}}
                        </div>
                        <div class="card-body">
                          <h5 class="card-title">{{curso.nombre}}</h5>
                          <p class="card-text">Liceo Tecnólogico Manheim</p>
                        </div>
                      </div>
                </div>
                <div class="card shadow w-100 my-2" style="height: 70%;">
                    <div class="text-center h-100">
                        <div class="card-body h-100">
                            <div class="row mx-0 w-100">
                                <div class="col-8">
                                    <h5 class="card-title fw-bold">Alumnos del Curso</h5>
                                </div>
                                <div class="col-4">
                                    <button class="btn btn-outline-primary py-0" data-bs-toggle="modal" data-bs-target="#gestionar">
                                        Gestionar
                                    </button>
                                    <!-- Modal -->
                                    <div class="modal fade" id="gestionar" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Gestionar Alumnos del Curso</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body px-0">
                                                    <div class="row mx-0 w-100">
                                                        <div class="col-12 ">
                                                            <form action="{% url 'cursos_app:gestionar'%}" method="POST" class="w-100 d-flex flex-column align-items-center justify-content-center">
                                                                {% csrf_token %}
                                                                <input type="hidden" value="{{curso.id_curso}}" name="curso">
                                                                <select multiple="multiple" id="my-select" name="alumnos">
                                                                    {% for a in alumnos  %}
                                                                    {% get_curso_pasado a as curso_pasado%}
                                                                    {% get_all_pks curso.curso_alumno_set.all a.rut as is_true%}
                                                                    
                                                                    {% if is_true %}
                                                                    <option value='{{a.rut}}' selected disabled>{{a.apellido_paterno}} {{a.apellido_materno}} {{a.nombre}} </option>                           
                                                                    {% else %}
                                                                    <option value='{{a.rut}}'>{{a.apellido_paterno}} {{a.nombre}}                         
                                                                        (Anterior: {{curso_pasado}})
                                                                    </option>     

                                                                    {% endif %}
                                                                        
                                                                    {% endfor %}
                        
                                                                        
                                                                </select>
                                                                <div class="modal-footer w-100 py-1" style="margin-top: 20px;">
                                                                    <div class="row m-0 w-100">
                                                                        <div class="col-6">
                                                                            <button type="button" class="btn btn-secondary w-100 py-1" data-bs-dismiss="modal">Cancelar</button>
                                                                        </div>
                                                                        <div class="col-6">
                                                                            <button type="submit" class="btn btn-primary w-100 py-1">Guardar</button>
                                                                        </div>

                                                                    </div>
                                                                </div>                                               
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="w-100" style="height: 90%;">
                                {% if curso.alumnos.all.count > 0 %}
                                <table class="table table-borderless table-sm">
                                    <thead class="text-start">
                                      <tr>
                                        <th scope="col">A. Paterno</th>
                                        <th scope="col">Nombre</th>
                                        <th scope="col">Rut</th>
                                        <th scope="col" colspan="2"></th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      
                                      {% for a in curso.alumnos.all  %}
                                      
                                      <tr class="text-start">
                                        
                                        <td class="fw-light">{{a.apellido_paterno}}</td>
                                        <td class="fw-light">{{a.nombre}}</td>
                                        <td class="fw-light">{{a.rut}}</td>
                                        <td class="fw-light">
                                            <button class="btn p-0 text-danger" type="button" data-bs-toggle="modal" data-bs-target="#drop{{a.rut}}">
                                                <i class="fal fa-times"></i>
                                            </button>
                                        </td>
                                        <td class="fw-light"><a href="{% url 'alumnos_app:actualizar' a.rut %}" class="p-0"><i class="fad fa-address-card"></i></a></td>
                                      </tr>
                                      <!-- Modal -->
                                    <div class="modal fade" id="drop{{a.rut}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="staticBackdropLabel"><i class="fad fa-window-restore text-danger"></i> Remover alumno del curso</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="clearAll(this);" id={{a.rut}}></button>
                                                </div>
                                                <div class="modal-body">
                                                <p class="fw-light">¿Porque desea remover a 
                                                    <span class="fw-bold">{{a.nombre}} {{a.apellido_paterno}} {{a.apellido_materno}}</span>
                                                    del curso?</p>
                                                    <form action="{% url 'cursos_app:removerAlum' %}" method="POST" id="formRazon">
                                                        {% csrf_token %}
                                                        <input type="hidden" value="{{curso.id_curso}}" name="curso">
                                                        {% if curso.numero > 1 %}
                                                        <div class="form-check-inline">
                                                            <input class="form-check-input" type="radio" name="razon" onclick="handleClick(this);" value="repitente_{{a.rut}}" id="radrepitente{{a.rut}}">
                                                            <label class="form-check-label" for="flexRadioDefault1">
                                                              Repitente
                                                            </label>
                                                        </div>
                                                        {% endif %}
                                                            
                                                        <div class="form-check-inline">
                                                            <input class="form-check-input" type="radio" name="razon" onclick="handleClick(this);" value="abandono_{{a.rut}}" id="radabandono{{a.rut}}">
                                                            <label class="form-check-label" for="flexRadioDefault2">
                                                                Abandono
                                                            </label>
                                                        </div>
                                                        <div class="form-check-inline">
                                                            <input class="form-check-input" type="radio" name="razon" onclick="handleClick(this);" value="error_{{a.rut}}" id="raderror{{a.rut}}">
                                                            <label class="form-check-label" for="flexRadioDefault2">
                                                                Por error
                                                            </label>
                                                        </div>
                                                        <div class="my-2">
                                                            <h6 class="d-none" id="repitente_{{a.rut}}">El alumno sera movido al curso <span class="fw-bold text-danger">{{curso_ant}}</span></h6>
                                                            <h6 class="d-none" id="error_{{a.rut}}">El alumno quedara <span class="fw-bold text-danger">sin curso</span></h6>
                                                            <h6 class="d-none" id="abandono_{{a.rut}}">El alumno quedara como <span class="fw-bold text-danger">no regular</span></h6>
                                                            <h6 class="d-none text-danger" id="validar">Si quiere remover al alumno, debe seleccionar Razón.</h6>
                                                        </div>
                                                        <div class="modal-footer py-0">
                                                            <button type="button" onclick="clearAll(this);" id={{a.rut}} class="btn btn-secondary float-left py-1" data-bs-dismiss="modal">Cancelar</button>
                                                            <button type="submit" class="btn btn-danger py-1">Remover</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                      {% endfor %}
                                          
                                    </tbody>
                                  </table>
                                <!-- <ul class="list-group list-group-flush shadow-sm">
                                    <li class="list-group-item list-group-item-action rounded text-start">
                                        <span class="text-decoration-underline">Apellidos Nombre</span>
                                        <span class="text-decoration-underline float-right">Rut</span>
                                    </li>
                                    {% for a in curso.alumnos.all %}
                                    <a href="{% url 'alumnos_app:actualizar' a.rut%}" class="list-group-item list-group-item-action rounded text-start">
                                        {{a.apellido_paterno}}
                                        {{a.apellido_materno}}
                                        {{a.nombre}}
                                        <span class="float-right">
                                            {{a.rut}}
                                        </span>
                                    </a>
                                    {% endfor %}                   
                                </ul> -->
                                {%else%}
                                <h6>Curso vacío</h6>
                                {% endif %}
                            </div>               
                          </div>
                    </div>
                </div>
            </div>
            <div class="col-8 h-100 p-3">
                <div class="card shadow h-100">
                    <div class="row mx-0 w-100">
                        <div class="col-4 d-flex flex-column align-items-end justify-content-center p-3">
                            <div class="rounded-circle bg-success " style="width: 76px;height:85px;">      
                                <img src="{% static 'imgs/MANNHEIM.png' %}" alt="" class="img-fluid w-100 h-100">
                            </div>
                        </div>
                        <div class="col-8 d-flex flex-column align-items-start justify-content-center p-3">
                            <h1 class="fw-bold">{{curso.nombre}}</h1>
                            <h5 class="fst-italic float-right text-muted">Identificador: {{curso.id_curso}}</h5>
                        </div>
                    </div>
                    <div class="row mx-0 w-100 h-100">
                        <div class="col-5">
                            <div class="card shadow w-100">
                                <div class="card-body">
                                    <h5 class="card-title">Información General</h5>
                                    <div class="row mx-0 w-100">
                                        <div class="col-6 px-0">
                                            <p class="card-text my-0">Electivo</p>
                                            <h6>{% if curso.electivo %}{{curso.get_electivo_display}}{%else%}Sin electivo{% endif %}</h6> 
                                        </div>
                                        <div class="col-6 px-0">
                                            <p class="card-text my-0">Total Alumnos</p>
                                            <h6>{{curso.alumnos.all.count}}</h6> 
                                        </div>
                                    </div>
                                                
                                    <p class="card-text my-0">Paralelo</p>
                                    <h6>Curso {{curso.letra}}</h6>               
                                    <p class="card-text my-0">Profesor Jefe</p>
                                    <h6>{{curso.id_prof_jefe.nombres}} {{curso.id_prof_jefe.apellido_paterno}} {{curso.id_prof_jefe.apellido_materno}}</h6>               
                                  </div>
                            </div>
                            <div class="card shadow w-100 my-3">
                                <div class="card-body">
                                    <h5 class="card-title">Información sobre el Curso</h5>
                                    <p class="card-text my-0">Fecha de inicio de clases</p>
                                    <h6>{{curso.cod_fecha.fecha_inicio}}</h6>            
                                    <p class="card-text my-0">Fecha fin de clases</p>
                                    <h6>               
                                    {% if curso.cod_fecha.fecha_termino %}
                                    {{curso.cod_fecha.fecha_termino}}
                                    {%else%}
                                    En curso
                                    {% endif %}
                                    </h6> 
                                    <div class="row mx-0 w-100">
                                        <div class="col-6 px-0">
                                            <p class="card-text my-0">Año</p>
                                            <h6>{{curso.cod_fecha.year}}</h6> 
                                        </div>
                                        <div class="col-6 px-0">
                                            <p class="card-text my-0">Semestre</p>
                                            <h6>{{curso.cod_fecha.semestres}}</h6> 
                                        </div>
                                    </div>               
                                                 
                                  </div>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="card shadow w-100">
                                <div class="card-body">
                                    <h5 class="card-title">Asignaturas Tomadas</h5>
                                    <p class="card-text my-0">Plan de estudio</p>
                                    <h6>{{curso.plan_estudio.nombre}}</h6>            
                                    <p class="card-text my-0">Asignaturas</p>
                                    <div style="height: 180px;" class="w-100 overflow-auto">
                                        
                                        {% if curso.plan_estudio.asignaturas.all.count > 0 %}
                                        <ul class="list-group list-group-flush">
                                            {% for a in curso.plan_estudio.asignaturas.all %}
                                            <a href="#" class="list-group-item list-group-item-action rounded text-start">{{a.nombre}}</a>
                                            {% endfor %}       
                                                  
                                        </ul>
                                        {%else%}
                                        <h6>Sin asignaturas</h6>
                                        {% endif %}
                                            
                                    </div>               
                                  </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock 'content' %}
{% block 'js-select2' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
<script src="{% static 'js/jquery.multi-select.js' %}"></script> 
<script src="{% static 'js/showInfoByRadio.js' %}"></script> 
<script>
    $(document).ready(function() {
      $('#my-select').multiSelect({
        selectableHeader: "<div class='bg-primary rounded text-light p-1 my-2'>Alumnos En Espera</div>",
        selectionHeader: "<div class='bg-primary rounded text-light p-1 my-2'>Alumnos Añadidos</div>",
      });
  });
    
    
  </script>
{% endblock 'js-select2' %}